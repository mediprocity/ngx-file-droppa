!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define("ngx-file-droppa",["exports","@angular/common","@angular/core"],n):n((e=e||self)["ngx-file-droppa"]={},e.ng.common,e.ng.core)}(this,(function(e,n,t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function i(e,n,t,i){var o,r=arguments.length,l=r<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,n,t,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(l=(r<3?o(l):r>3?o(n,t,l):o(n,t))||l);return r>3&&l&&Object.defineProperty(n,t,l),l}function o(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,o,r=t.call(e),l=[];try{for(;(void 0===n||n-- >0)&&!(i=r.next()).done;)l.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return l}function r(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(o(arguments[n]));return e}var l=function(e){this.loading=!1,this.percentage=0,this.removing=!1,this.responseMessage="Error happened during upload",this.id=Math.random().toString(36).substr(2),this.loadingSuccessful=!0,this.uploader=null,this.File=e},s=function(){function e(){this.filesUpdated=new t.EventEmitter(!0),this.startAutoUploading=null,this.beforeAddFile=null,this.WSfiles=new WeakSet,this._iFiles=[]}return Object.defineProperty(e.prototype,"files",{get:function(){return this.iFiles.reduce((function(e,n){return e.push(n.File),e}),[])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iFiles",{get:function(){return this._iFiles},set:function(e){this._iFiles=e},enumerable:!0,configurable:!0}),e.prototype.addFiles=function(e){var n=this;e=e.filter((function(e){if(!n.WSfiles.has(e))return"function"==typeof n.beforeAddFile&&n.beforeAddFile(e)?(n.WSfiles.add(e),!0):"function"!=typeof n.beforeAddFile})).map((function(e){var t=new l(e);return n.startAutoUploading&&n.startAutoUploading(t),t})),this.iFiles=r(this.iFiles,e),this.filesUpdated.emit(!0)},e.prototype.removeFiles=function(e){this.WSfiles.delete(e.File),this.iFiles=this.iFiles.filter((function(n){return n.id!==e.id})),this.filesUpdated.emit(!0)},e.prototype.clearStore=function(){var e=this;this.iFiles.forEach((function(n){e.WSfiles.delete(n.File)})),this.iFiles=[],this.filesUpdated.emit(!0)},e=i([t.Injectable()],e)}(),p=function(){function e(){this.zone=new t.NgZone({enableLongStackTrace:!1}),this.url=null,this.beforeRequest=null,this.beforeFileUpload=null,this.fileUploadedEvent=new t.EventEmitter(!0)}return e.prototype.uploadFiles=function(e){var n=this;return Promise.all(e.reduce((function(e,t){return e.push(n.uploadFile(t)),e}),[]))},e.prototype.uploadFile=function(e){var n=this;if(!this.url)throw"url to upload needs to be provided";if(e.loading)throw"Already under loading";var t=this,i=new FormData,o=new XMLHttpRequest;o.upload.onprogress=function(t){var i=100*t.loaded/t.total|0;n.zone.run((function(){e.percentage=i}))};var r=new Promise((function(n,i){o.onload=o.onerror=function(o){var r=this;t.zone.run((function(){200==r.status?(e.loading=!1,e.loadingSuccessful=!0,n(!0)):(e.loading=!1,e.loadingSuccessful=!1,i(!1))}))}})).then((function(t){n.fileUploadedEvent.emit([t,o.response,e])}),(function(t){n.fileUploadedEvent.emit([t,o.response,e])}));return e.loading=!0,o.open("POST",this.url,!0),"function"==typeof this.beforeRequest&&this.beforeRequest(o),i.append(""+e.File.name,e.File),"function"==typeof this.beforeFileUpload?Promise.resolve(this.beforeFileUpload(i)).then((function(n){n&&o.send(n),n||console.warn("beforeFileUpload didn't return formData for "+e.File.name+" and upload was aborted")})):o.send(i),r},e=i([t.Injectable()],e)}(),a=function(){function e(e,n){var i=this;this.filesStore=e,this.fileUploadService=n,this.showFilesList=!0,this.autoUpload=!1,this.beforeRequest=null,this.beforeFileUpload=null,this.beforeAddFile=null,this.dropZoneTemplate='\n      <div class="file_dropZone_internal">\n          Drop Files Here\n      </div>\n    ',this.filesUpdated=new t.EventEmitter(!0),this.fileUploaded=new t.EventEmitter(!0),this.uploadButtonTemplate='\n      <div class="file-droppa-btn orange">\n        <span>Upload All Files</span>\n       </div>\n    ',this.removeButtonTemplate='\n      <div class="file-droppa-btn red">\n        <span>Remove All Files</span>\n       </div>\n    ',this.multiple=!0,e.filesUpdated.subscribe((function(){i.filesUpdated.emit(e.files)})),n.fileUploadedEvent.subscribe((function(e){var n=o(e,3),t=n[0],r=n[1],l=n[2];t?i.filesStore.removeFiles(l):(l.loadingSuccessful=!1,l.responseText=!1),i.fileUploaded.emit([t,r,l.file])})),e.startAutoUploading=this.startAutoUploading.bind(this)}return Object.defineProperty(e.prototype,"url",{set:function(e){this.fileUploadService.url=e},enumerable:!0,configurable:!0}),e.prototype.startAutoUploading=function(e){this.autoUpload&&this.fileUploadService.uploadFile(e)},e.prototype.ngOnInit=function(){this.filesStore.beforeAddFile="function"==typeof this.beforeAddFile?this.beforeAddFile:function(e){return!0},this.fileUploadService.beforeRequest=this.beforeRequest,this.fileUploadService.beforeFileUpload="function"==typeof this.beforeFileUpload?this.beforeFileUpload:function(e){return!0}},e.prototype.removeAllFiles=function(){this.filesStore.clearStore()},e.prototype.uploadAllFiles=function(){this.fileUploadService.uploadFiles(this.filesStore.iFiles)},e.ctorParameters=function(){return[{type:s},{type:p}]},i([t.Input()],e.prototype,"showFilesList",void 0),i([t.Input()],e.prototype,"autoUpload",void 0),i([t.Input()],e.prototype,"beforeRequest",void 0),i([t.Input()],e.prototype,"url",null),i([t.Input()],e.prototype,"beforeFileUpload",void 0),i([t.Input()],e.prototype,"beforeAddFile",void 0),i([t.Input()],e.prototype,"dropZoneTemplate",void 0),i([t.Output()],e.prototype,"filesUpdated",void 0),i([t.Output()],e.prototype,"fileUploaded",void 0),i([t.Input()],e.prototype,"uploadButtonTemplate",void 0),i([t.Input()],e.prototype,"removeButtonTemplate",void 0),i([t.Input()],e.prototype,"multiple",void 0),e=i([t.Component({selector:"fileDroppa",providers:[s,p],encapsulation:t.ViewEncapsulation.None,template:'\n        <div class="file-droppa-container">\n            <fileDropZone [multiple]="multiple">\n                <div [innerHTML]="dropZoneTemplate"></div>\n            </fileDropZone>\n            <br/>\n            <ng-content></ng-content>\n            <fileList *ngIf="showFilesList"></fileList>\n            <div class="file-droppa-btns" *ngIf="filesStore.iFiles.length">\n              <div #uploadButtonArea (click)="uploadAllFiles()">\n                <ng-content select="[upload-button]"></ng-content>\n              </div>\n              <div *ngIf="uploadButtonArea.children.length === 0" (click)="uploadAllFiles();"\n                   [innerHTML]="uploadButtonTemplate"></div>\n              <div #removeButtonArea (click)="removeAllFiles();">\n                <ng-content select="[remove-button]"></ng-content>\n              </div>\n              <div *ngIf="removeButtonArea.children.length === 0" (click)="removeAllFiles();"\n                   [innerHTML]="removeButtonTemplate"></div>\n            </div>\n        </div>\n    ',styles:["\n        .file-droppa-container {\n            width: 400px;\n        }\n        .file-droppa-btns {\n         display: flex;\n          align-items: center;\n          justify-content: center;\n\n        }\n        .file-droppa-btn {\n              margin: 15px;\n              padding: 0;\n\n              overflow: hidden;\n\n              border-width: 0;\n              outline: none;\n              border-radius: 2px;\n              box-shadow: 0 1px 4px rgba(0, 0, 0, .6);\n\n              background-color: #2ecc71;\n              color: #ecf0f1;\n\n              transition: background-color .3s;\n              width: 140px;\n              text-align: center;\n              font-size: 12px;\n\n        }\n\n        .file-droppa-btn:hover{\n          background-color: #27ae60;\n        }\n\n        .file-droppa-btn span {\n          display: block;\n          padding: 12px 24px;\n        }\n\n        .file-droppa-btn.orange {\n          background-color: #e67e22;\n        }\n\n        .file-droppa-btn.orange:hover {\n          background-color: #d35400;\n        }\n\n        .file-droppa-btn.red {\n          background-color: #e74c3c;\n        }\n\n        .file-droppa-btn.red:hover{\n          background-color: #c0392b;\n        }\n        "]})],e)}(),d=function(){function e(){this.ext="",this.previewSrc="",this.fileName="",this.previewHeight=75,this.removeFile=new t.EventEmitter(!0)}return e.prototype.ngAfterContentInit=function(){this.file&&this.getFileType()},e.prototype.removeFileListener=function(e){e.preventDefault(),this.removeFile&&this.removeFile.emit(!0)},e.prototype.getFileType=function(){var e,n=this;if(!/^image\//.test(this.file.type)){var t=this.file.name.split(".").pop();return this.fileName=this.file.name,void(this.ext=t.length>3?"file":"."+t)}(e=new FileReader).addEventListener("load",(function(){var t=new Image,i=e.result;t.onload=function(){var e=t.height/t.width*n.previewHeight;n.previewSrc=i,n.previewHeight=e<n.previewHeight?n.previewHeight:e},t.src=i}),!1),this.file&&e.readAsDataURL(this.file)},i([t.Input()],e.prototype,"file",void 0),i([t.Input()],e.prototype,"index",void 0),i([t.Input()],e.prototype,"percentage",void 0),i([t.Input()],e.prototype,"loadingSuccessful",void 0),i([t.Input()],e.prototype,"responseMessage",void 0),i([t.Output()],e.prototype,"removeFile",void 0),e=i([t.Component({selector:"fileItem",template:'\n        <div *ngIf="file" class="file-container">\n            <div class="flex-block file-preview" [ngStyle]="{\'background-image\': \'url(\' + previewSrc + \')\', \'height\': previewHeight + \'px\'}">\n                <div *ngIf="ext" class="flex-block file-preview-ext ">{{ext}}</div>\n                <div *ngIf="!previewSrc" class="flex-block file-name">{{fileName}}</div>\n                <progress [value]="percentage" max="100" class="file-progress"></progress>\n            </div>\n            <div class="file-remove">\n                <span class="remove"><a href="#" (click)="removeFileListener($event)"></a></span>\n            </div>\n            <div *ngIf="!loadingSuccessful" class="file-upload-error">\n                <span class="warning"></span>\n                <span *ngIf="responseMessage" class="tooltiptext">{{responseMessage}}</span>\n            </div>\n            <div class="flex-block">{{file.size | getSize }}</div>\n        </div>\n    ',styles:['\n        .file-container {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            width: 75px;\n            margin: 20px 10px 0 0;\n            transition: opacity 0.5s, margin 0.5s linear;\n            flex-direction: column;\n            position:relative;\n        }\n\n        .file-container.uploaded {\n            opacity: 0;\n            margin: 0;\n            height: 0;\n            overflow: hidden;\n        }\n\n        .flex-block {\n            width: 90%;\n            text-align: center;\n            font-size: 0.8em;\n            margin: 2px 0;\n        }\n\n        .file-remove {\n            cursor: pointer;\n            position: absolute;\n            left: 87%;\n            top: 8px;\n        }\n        .file-upload-error {\n            position: absolute;\n            top: 8px;\n            left:-8px;\n        }\n        .file-name {\n            text-overflow: ellipsis;\n            overflow: hidden;\n        }\n\n        .file-preview {\n            background: #ccc;\n            border-radius: 2px;\n            width: inherit;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-direction: column;\n            background-size: cover;\n            color: #fff;\n        }\n\n         .file-preview-ext {\n            text-transform: uppercase;\n        }\n\n        .file-progress {\n            width: 80%;\n            display: block;\n        }\n\n\n        button {\n            margin: 0;\n        }\n\nspan {\n    position:relative;\n    z-index:1;\n    overflow:hidden;\n    list-style:none;\n    padding:0;\n    margin:0 0 0.25em;\n}\n\nspan a:link {\n    display:block;\n    border:0;\n    padding-left:28px;\n    color:#c55500;\n}\n\nspan a:hover,\nspan a:focus {\n    color:#730800;\n    background:transparent;\n}\n\nspan:before,\nspan:after,\nspan a:before,\nspan a:after {\n    content:"";\n    position:absolute;\n    top:50%;\n    left:0;\n}\n\nspan a:before,\nspan a:after {\n    margin:-8px 0 0;\n    background:#c55500;\n}\n\nspan a:hover:before,\nspan a:focus:before {\n    background:#730800;\n}\n\n\n.remove a:before {\n    width:16px;\n    height:16px;\n    /* css3 */\n    -webkit-border-radius:16px;\n    -moz-border-radius:16px;\n    border-radius:16px;\n}\n\n.remove a:after {\n    left:3px;\n    width:10px;\n    height:2px;\n    margin-top:-1px;\n    background:#fff;\n}\n.warning:before {\n    content:"!";\n    z-index:2;\n    left:8px;\n    margin-top:-8px;\n    font-size:14px;\n    font-weight:bold;\n    color:#000;\n}\n\n.warning:after {\n    z-index:1;\n    border-width:0 11px 18px;\n    border-style:solid;\n    border-color:#F8D201 transparent;\n    margin-top:-10px;\n    background:transparent;\n}\n\n.file-upload-error .tooltiptext {\n    visibility: hidden;\n    white-space:nowrap;\n    background-color: black;\n    color: #fff;\n    text-align: center;\n    padding: 5px;\n    border-radius: 6px;\n\n    /* Position the tooltip text - see examples below! */\n    position: absolute;\n    z-index: 1;\n}\n\n.file-upload-error:hover .tooltiptext {\n    visibility: visible;\n}\n\n    ']})],e)}(),u=function(){function e(){}return e.prototype.processFilesFromInput=function(e){var n=this,t=Object.keys(e).reduce((function(t,i){var o,r=e[i];if(null!=r.webkitGetAsEntry&&(o=r.webkitGetAsEntry()))o.isFile?t.push(Promise.resolve(r.getAsFile())):o.isDirectory&&t.push(n.processDirectory(o));else if(null!=r.getAsFile)null!=r.kind&&"file"!==r.kind||t.push(Promise.resolve(r.getAsFile()));else if(r.isFile){var l=new Promise((function(e,n){r.file(e,n)}));t.push(l)}else r.isDirectory&&t.push(n.processDirectory(r));return t}),[]);return Promise.all(t).then(this.flattenArrayOfFiles)},e.prototype.processDirectory=function(e){var n=this,t=e.createReader(),i=[],o=function(){return new Promise((function(e,r){t.readEntries((function(t){var r=[];if(t.length)for(var l=0;l<t.length;l++)r.push(n.processFilesFromInput({0:t[l]}));else e(null);i.push(o()),Promise.all(r).then(n.flattenArrayOfFiles).then(e)}),(function(e){r("Error while reading folder")}))}))};return i.push(o()),Promise.all(i).then(this.flattenArrayOfFiles)},e.prototype.processInputFromDrop=function(e){var n=e.dataTransfer.items;if(n&&n.length&&null!=n[0].webkitGetAsEntry)return Promise.resolve(this.processFilesFromInput(n));if(n&&n.length&&!n[0].webkitGetAsEntry)return Promise.resolve(n);if(e.dataTransfer.files){for(var t=[],i=0,o=e.dataTransfer.files.length;i<o;i++)t.push(e.dataTransfer.files[i]);return Promise.resolve(t)}},e.prototype.flattenArrayOfFiles=function(e){return Promise.resolve(e.reduce((function(e,n){if(n)return r(e,[n])}),[]))},e=i([t.Injectable()],e)}(),f=function(){function e(e,n,t){this.filesStore=e,this.el=n,this.fileParser=t,this.hiddenFileInput=null,this.promise=null,this.createHiddenInput()}return Object.defineProperty(e.prototype,"multiple",{set:function(e){e?this.hiddenFileInput.setAttribute("multiple","multiple"):this.hiddenFileInput.removeAttribute("multiple")},enumerable:!0,configurable:!0}),e.prototype.onClick=function(e){this.hiddenFileInput&&this.hiddenFileInput.click()},e.prototype.drop=function(e){var n=this;e.preventDefault(),e.dataTransfer&&e.dataTransfer.files.length&&(this.promise=this.fileParser.processInputFromDrop(e).then((function(e){n.updateFilesStore(r(e))})),this.updateStyles())},e.prototype.dragenter=function(e){e.preventDefault()},e.prototype.dragover=function(e){e.preventDefault(),this.updateStyles(!0)},e.prototype.dragleave=function(e){e.preventDefault(),this.updateStyles()},e.prototype.OnDestroy=function(){this.hiddenFileInput&&document.body.removeChild(this.hiddenFileInput),this.hiddenFileInput=null},e.prototype.updateStyles=function(e){void 0===e&&(e=!1)},e.prototype.updateFilesStore=function(e){this.filesStore.addFiles(e)},e.prototype.createHiddenInput=function(){var e=this;this.hiddenFileInput&&document.body.removeChild(this.hiddenFileInput),this.hiddenFileInput=document.createElement("input"),this.hiddenFileInput.setAttribute("type","file"),this.hiddenFileInput.setAttribute("multiple","multiple"),this.hiddenFileInput.style.visibility="hidden",this.hiddenFileInput.style.position="absolute",this.hiddenFileInput.style.top="0",this.hiddenFileInput.style.left="0",this.hiddenFileInput.style.height="0",this.hiddenFileInput.style.width="0",this.hiddenFileInput.className="_hiddenInputClassName",document.body.appendChild(this.hiddenFileInput),this.hiddenFileInput.addEventListener("change",(function(n){for(var t=[],i=0,o=n.target.files.length;i<o;i++)t.push(n.target.files[i]);e.hiddenFileInput.value="",e.updateFilesStore(t)}))},e.ctorParameters=function(){return[{type:s},{type:t.ElementRef},{type:u}]},i([t.Input()],e.prototype,"multiple",null),e=i([t.Component({selector:"fileDropZone, [fileDropZone]",providers:[u],template:"\n        <ng-content></ng-content>\n    ",host:{"(drop)":"drop($event)","(dragenter)":"dragenter($event)","(dragover)":"dragover($event)","(dragleave)":"dragleave($event)","(click)":"onClick($event)"},encapsulation:t.ViewEncapsulation.None,styles:["\n        .file_dropZone_internal {\n            border: 3px dashed #DDD;\n            border-radius:10px;\n            padding:10px;\n            width:400px;\n            height:200px;\n            color:#CCC;\n            text-align:center;\n            display:table-cell;\n            vertical-align:middle;\n            cursor:pointer;\n        }\n    "]})],e)}(),c=function(){function e(e){this.filesStore=e}return e.prototype.removeFile=function(e){this.filesStore.removeFiles(e)},e.ctorParameters=function(){return[{type:s}]},e=i([t.Component({selector:"fileList, [fileList]",template:'\n        <div class="file-list">\n            <fileItem *ngFor="let file of filesStore.iFiles"\n                [file]="file.File"\n                [percentage]="file.percentage"\n                [loadingSuccessful]="file.loadingSuccessful"\n                [responseMessage]="file.responseMessage"\n                (removeFile)="removeFile(file)">\n            </fileItem>\n        </div>\n    ',styles:["\n        .file-list {\n            width: 430px;\n            margin-bottom: 5px;\n            display: flex;\n            flex-flow: wrap;\n            justify-content: flex-start;\n         }\n    "]})],e)}(),h=function(){function e(){}return e.prototype.transform=function(e){var n=e||0,t=Math.floor(Math.log(n)/Math.log(1e3));return 0===n?"0 Byte":(n/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},e=i([t.Pipe({name:"getSize"})],e)}(),v=function(){function e(){}return e=i([t.NgModule({imports:[n.CommonModule],declarations:[h,a,d,f,c],exports:[a,d,f,c]})],e)}();e.NgxFileDroppaModule=v,e.ɵa=h,e.ɵb=a,e.ɵc=s,e.ɵd=p,e.ɵe=d,e.ɵf=f,e.ɵg=u,e.ɵh=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-file-droppa.umd.min.js.map